<!DOCTYPE html>
<html>
<body>

<button onclick="startRecording()">Start Recording</button>
<button onclick="stopRecording()">Stop Recording</button>

<script>
let mediaRecorder;
let chunks = [];

function startRecording() {
  navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.start();

      mediaRecorder.ondataavailable = function(e) {
        chunks.push(e.data);
      }
    });
}

function stopRecording() {
  mediaRecorder.stop();

  mediaRecorder.onstop = function(e) {
    let blob = new Blob(chunks, { 'type' : 'audio/wav; codecs=opus' });
    chunks = [];

//    let audioURL = URL.createObjectURL(blob);
    // 이제 audioURL 변수를 사용하여 오디오를 서버에 업로드하거나 다운로드 링크를 생성할 수 있습니다.
    // 예를 들어, 다음은 오디오를 다운로드하는 링크를 생성하는 코드입니다.
//    let link = document.createElement('a');
//    link.href = audioURL;
//    link.download = './instance/recorded_audio.wav';
//    link.click();
let formData = new FormData();
formData.append("audio", blob);

fetch('/upload', {
    method: 'POST',
    body: formData
}).then(response => {
    if(response.ok) {
        console.log('Audio successfully uploaded');
    } else {
        console.error('Upload failed');
    }
}).catch(error => console.error('Error:', error));
  }
}
</script>

</body>
</html>
